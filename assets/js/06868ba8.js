"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[284],{51930:(t,e,i)=>{i.d(e,{Kn:()=>y,fN:()=>h,k$:()=>u,nI:()=>l});var a=i(20918),r=i(62190),d=i(80661),n=i.n(d),s=i(38734);const h=async t=>{try{const e=await s.hj.get(`${a.H}weather/city`,{location:t,lang:a.sM?"zh":"en"},{_delay:200,_single:!0});if(0===e.code&&e.data.list.length>0)return[null,e.data.list.map((t=>({...t,cid:t.id})))];throw e}catch(t){return["catch error"]}},o=t=>(t.updateTime=n()(t.updateTime).valueOf(),t.daily=t.daily.map((t=>{const e=(0,r.sG)(t.fxDate);return{...t,fxDateStr:a.sM?e.format("M月D ddd"):e.format("MMM D, ddd"),dateStr:e.format("ddd"),weekStr:a.sM?e.format("D日"):e.format("D"),tempMax:t.tempMax+"°",tempMin:t.tempMin+"°"}})),t),c=t=>(t.updateTime=n()(t.updateTime).valueOf(),t.hourly=t.hourly.map((t=>({...t,fxTimeStr:n()(t.fxTime).format("HH:mm"),temp:t.temp+"°",windScale:a.sM?t.windScale+"级":"级"+t.windScale,windSpeed:t.windSpeed+"km/h",humidity:t.humidity+"%",precip:t.precip+"mm"}))),t),l=async t=>{try{const e=await s.hj.get(`${a.H}weather/daily`,{location:t,lang:a.sM?"zh":"en"},{_delay:0});if(0===e.code)return[null,o(e.data)];throw e}catch(t){return["catch error"]}},y=async t=>{try{const e=await s.hj.get(`${a.H}weather/hourly`,{location:t,lang:a.sM?"zh":"en"},{_delay:0});if(0===e.code)return[null,c(e.data)];throw e}catch(t){return["catch error"]}},u=async()=>{try{const t=await s.hj.get(`${a.H}weather/location`,{},{_delay:0});if(0===t.code)return[null,t.data];throw t}catch(t){return["catch error"]}}},94766:(t,e,i)=>{i.d(e,{i7:()=>l,iE:()=>s,m_:()=>h,x4:()=>c,zI:()=>d});var a=i(20918),r=i(51930);const d="location",n={sunny:[[100],[150]],cloudy:[[101,104],[151,154]],rain:[[300,399]],snow:[[400,499]],haze:[[500,515]]};function s(t){const e=Number(t);let i="cloudy";for(const t in n){if(n[t].some((a=>{if(1===a.length){if(e===a[0])return i=t,!0}else if(2===a.length&&e>=a[0]&&e<=a[0])return i=t,!0})))break}return i}const h=t=>`${a.c1}/weather-icon/${t}.png`,o=a.sM?"116.40528,39.90498":"-73.96900,40.77899";function c(t){return new Promise((e=>{let i=!1,d=!1;const n=t=>{i=!0,e(t)};a.s$||navigator.geolocation.getCurrentPosition((t=>n(`${t.coords.longitude},${t.coords.latitude}`)),(()=>{d=!0,(0,r.k$)().then((t=>{let[e,i]=t;null===e&&n(i)}))}),{timeout:5e3}),setTimeout((()=>{i||d||(0,r.k$)().then((t=>{let[e,i]=t;null===e&&n(i)}))}),a.s$?0:2e3),setTimeout((()=>{n(t?"":o)}),5e3)}))}const l=(t,e)=>`weather-bg-${e||"cloudy"}-${t}`},70284:(t,e,i)=>{i.r(e),i.d(e,{useWeatherStore:()=>h});var a=i(59590),r=i(10435),d=i(94766),n=i(51930),s=i(34906);const h=(0,r.Q_)(a.BU.weather,{syncStorage:{watch:["weathers","locationCity","addedCity","activeCityId"]},syncCloud:{watch:["addedCity","activeCityId"]},state:()=>({searchModalShow:!1,modalShow:!1,weathers:{},locationCity:{cid:"",name:"",adm1:"",adm2:"",expired:0},addedCity:[],activeCityId:d.zI}),getters:{allCids(){return this.addedCity.map((t=>t.cid)).concat(this.locationCity.cid)},activeCid(){return this.activeCityId===d.zI?this.locationCity.cid:this.activeCityId},getCityWeather:t=>e=>t.weathers[e],activeCityWeather(){return this.getCityWeather(this.activeCid)},activeNow(){var t;return null===(t=this.activeCityWeather)||void 0===t?void 0:t.now},activeDay(){var t;return null===(t=this.activeCityWeather)||void 0===t?void 0:t.day},activeHour(){var t;return null===(t=this.activeCityWeather)||void 0===t?void 0:t.hour},activeTempRange(){var t,e;const i=null===(t=this.activeCityWeather)||void 0===t||null===(e=t.day)||void 0===e?void 0:e.list;if(i){const t=i[0].tempMin;return`${i[0].tempMax} ~ ${t}`}return""},activeCity(){return this.activeCityId===d.zI?this.locationCity:this.addedCity.find((t=>t.cid===this.activeCityId))},addedCityIds(){return this.addedCity.map((t=>t.cid))},activeCityLongName(){return this.activeCity?this.activeCity.adm2===this.activeCity.name?this.activeCity.name:this.activeCity.adm2+" · "+this.activeCity.name:""}},actions:{async setSearchModal(t){this.searchModalShow=t,t&&(await this.reqLocation(!1),this.reqAllWeather())},async setModal(t){t?this.reqAllWeather():this.searchModalShow=!1,this.modalShow=t},setActive(t){this.activeCityId=t},async reqHourWeather(t){const[e,i]=await(0,n.Kn)(t);if(e)return;const a={list:i.hourly,expired:(0,s.Z)(i.expiredTime,Date.now()+12e4,Date.now()+36e5),updateTime:i.updateTime},r=i.hourly[0],h={updateTime:i.updateTime,type:(0,d.iE)(r.icon),temp:r.temp,icon:r.icon,text:r.text,windDir:r.windDir,windScale:r.windScale,windSpeed:r.windSpeed,humidity:r.humidity,precip:r.precip,pressure:r.pressure};this.weathers[t]={...this.weathers[t],hour:a,now:h},this.weathers={...this.weathers}},clearWeathers(){Object.keys(this.weathers).forEach((t=>{this.allCids.includes(t)||delete this.weathers[t]}))},async reqDayWeather(t){const[e,i]=await(0,n.nI)(t);if(e)return;const a={list:i.daily,expired:(0,s.Z)(i.expiredTime,Date.now()+12e4,Date.now()+288e5),updateTime:i.updateTime};this.weathers[t]={...this.weathers[t],day:a},this.weathers={...this.weathers}},async reqWeather(t){if(!t)return;const e=this.getCityWeather(t),i=[];e?((!e.day||e.day.expired<Date.now())&&i.push(this.reqDayWeather(t)),(!e.hour||e.hour.expired<Date.now())&&i.push(this.reqHourWeather(t))):i.push(this.reqDayWeather(t),this.reqHourWeather(t)),await Promise.all(i)},async reqAllWeather(){await Promise.all([this.reqWeather(this.locationCity.cid),...this.addedCity.map((t=>this.reqWeather(t.cid)))])},async reqLocation(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(!e){if(this.locationCity.expired>Date.now())return;if(t&&this.locationCity.cid)return}const i=await(0,d.x4)(!!this.locationCity.cid);if(!i)return;const[a,r]=await(0,n.fN)(i);if(a||!r)return;this.locationCity={cid:r[0].id,name:r[0].name,adm1:r[0].adm1,adm2:r[0].adm2,expired:Date.now()+2e3}}catch(t){}},async addCity(t){const e=this.addedCity.findIndex((e=>e.cid===t.cid));e>-1&&this.addedCity.splice(e,1),this.addedCity.unshift(t),this.addedCity.length>4&&(this.addedCity.length=4),this.addedCity=[...this.addedCity],await this.reqAllWeather(),this.clearWeathers()},removeCity(t){const e=this.addedCity.findIndex((e=>e.cid===t));e>-1&&(this.addedCity.splice(e,1),this.addedCity=[...this.addedCity]),this.clearWeathers()}}})},34906:(t,e,i)=>{i.d(e,{Z:()=>d});const a=function(t,e,i){return t==t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e&&(t=t>=e?t:e)),t};var r=i(21774);const d=function(t,e,i){return void 0===i&&(i=e,e=void 0),void 0!==i&&(i=(i=(0,r.Z)(i))==i?i:0),void 0!==e&&(e=(e=(0,r.Z)(e))==e?e:0),a((0,r.Z)(t),e,i)}}}]);